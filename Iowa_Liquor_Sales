SQL Project: Writing queries against a database containing all wholesale purchases of alcohol in the state of Iowa. THe database is located in Google's BigQuery and the BigQuery SQL Workspace was used for analysis
 
  
Basic Data Exploration:

How many years of data are there?

SELECT DISTINCT EXTRACT(YEAR from date) AS Year
FROM bigquery-public-data.iowa_liquor_sales.sales
ORDER BY Year DESC

Year
2022
2021
2020
2019
2018
2017
2016
2015
2014
2013
2012

As we can see, there are 10 unique years of data included in this dataset


How many unique cities and counties are located in the dataset?

SELECT 
  COUNT(DISTINCT city) AS Number_of_Cities, 
  COUNT(DISTINCT county) AS Number_of_Counties
FROM bigquery-public-data.iowa_liquor_sales.sales

Number_of_Cities	 Number_of_Counties
      847	              201

Unfortunately this is not the true answer. A quick Google search reveals that there are only 99 counties in Iowa. A look through the first 50 data entries in the 
'city' column reveals multiple entries for the same county, such as "Sioux Falls" and "SIOUX FALLS". Punctuation and spelling errors will have to be found, corrected, 
and combined.


How many unique liquors types are there?
 
SELECT DISTINCT category_name AS Number_of_Products
FROM bigquery-public-data.iowa_liquor_sales.sales
ORDER BY Number_of_Products DESC

Number_of_Products
135

Unfortunately this is not the true answer. Similar to the previous query, there are several instances in which there are multiple spellings of the same product, 
such as "Imported Vodkas" and "Imported Vodka". Punctuation and spelling errors will have to be found, corrected, and combined.
 
 
 
Questions:

What was the total revenue generated by alcohol sales last year (2021) in Iowa?

SELECT SUM(sale_dollars) AS Total_Liquor_Sales          #Adding up each individual sale amount
FROM bigquery-public-data.iowa_liquor_sales.sales
WHERE date BETWEEN '2021-01-01' AND '2021-12-31'        #Filtering out sales not from 2021

Total_Liquor_Sales
  428123535.40


What has been the total revenue generated by alcohol sales in Iowa each year since 2012?

SELECT 
  DISTINCT EXTRACT(YEAR from date) AS Year,
  SUM(sale_dollars) AS Total_Sales
FROM bigquery-public-data.iowa_liquor_sales.sales
GROUP BY Year
ORDER BY Year DESC

Results:

Year	Total_Sales
2022	96958258.030001268
2021	428123535.3999927
2020	396663131.6599943
2019	349220341.62998861
2018	334216843.07000631
2017	314530044.81004608
2016	299447564.85001493
2015	284328572.11001718
2014	270587738.09003007
2013	258103792.82005352
2012	255203313.57004404

Here I am creating one column with unique dates by extracting the year from the date column and another column with the Total Sales value for each year. 
The key here is the 'GROUP BY' function which organizes the sum totals by year

However, since 2022 is ongoing, I do not have a full picture of what sales looks like yet. Because of this, the Total_Sales value for 2022 is much lower than the others.
Therefore I will exclude 2022 from my queries:

SELECT 
  DISTINCT EXTRACT(YEAR from date) AS Year,
  ROUND(SUM(sale_dollars)) AS Total_Sales
FROM bigquery-public-data.iowa_liquor_sales.sales
WHERE date <='2021-12-31'        
GROUP BY Year
ORDER BY Year DESC

Year	Total_Sales
2021	428123535.4
2020	396663131.66
2019	349220341.63
2018	334216843.07
2017	314530044.81
2016	299447564.85
2015	284328572.11
2014	270587738.09
2013	258103792.82
2012	255203313.57

Now, data from the year 2022 has been removed.
I have also added the 'ROUND' command to round the sum totals to two decimal places.


What has been the average annual alcohol revenue in Iowa since 2012?

SELECT 
  AVG(sale_dollars) AS Average_Annual_Revenue       
FROM bigquery-public-data.iowa_liquor_sales.sales
WHERE date <='2021-12-31'     

Average_Revenue
138.88

This is clearly not the answer I was expecting. In this scenario, using the 'AVG' function in this case simply calculated the value of the average liquor purchase.
While this would be a perfect answer for "What was the average amount spent on a single liquor purchase from 2012 to 2021?", this does not answer my question. 

To fix this, instead of using the 'AVG' function, I will use the sum function and divide it by the number of full years of data (9). 
With this in place

SELECT 
    ROUND(SUM(sale_dollars/9),2) AS Average_Annual_Revenue  
FROM bigquery-public-data.iowa_liquor_sales.sales
WHERE date <='2021-12-31'

Average_Annual_Revenue
354491653.11

Now we can see the average annual revenue from alcohol sales in Iowa, which is around $350 million a year.









