SQL Project: For this project, I am writing queries against a database containing all wholesale purchases of alcohol 
	     in the state of Iowa in order to understand alcohol sales, volume, and preference across the state. 
             This database is named iowa_liquor_sales and is located within the public datasets in Google's BigQuery.
             The BigQuery SQL Workspace was used for analysis.

		

Data Exploration: 

Question 1: How many years of data are there?

SELECT DISTINCT EXTRACT(YEAR from date) AS Year
FROM bigquery-public-data.iowa_liquor_sales.sales
ORDER BY Year DESC

Year
2022
2021
2020
2019
2018
2017
2016
2015
2014
2013
2012

There are 10 unique years of data included in this dataset


Question 2: How many unique cities, countie, and liquor categories are present in the dataset?

Unique Counties:

In order to answer this question, I selected all the distinct county numbers from the column county_numbers

SELECT COUNT(DISTINCT county_number) AS Counties
FROM nth-baton-346119.iowa_liquor_sales.Iowa_Liquor_Sales_Table
;

Results:

Row Counties
 1    99

There are 99 unique Iowa counties in this dataset.

Unique Cities:

SELECT COUNT (DISTINCT city) AS Cities
FROM nth-baton-346119.iowa_liquor_sales.Iowa_Liquor_Sales_Table
WHERE city IS NOT NULL
;

Results: 

 Row  Cities	
  1    850

A quick count of the distinct cities results in a total of 850 cities. 
However, a closer look at a table reveals that multiple versions of many city names have been entered, such as "Akron" and "AKRON".

SELECT DISTINCT city AS Cities
FROM nth-baton-346119.iowa_liquor_sales.Iowa_Liquor_Sales_Table
WHERE city = "Akron" OR city = "AKRON"
;

Row   Cities	
 1    Akron
 2	  AKRON


To remedy this, I used the LOWER operator to change the case of all data rows to lowercase and then recounted the distinct city names

SELECT COUNT DISTINCT LOWER(city) AS City 
FROM nth-baton-346119.iowa_liquor_sales.Iowa_Liquor_Sales_Table
WHERE city IS NOT NULL
;

Results:
Row	   City	
 1	   467

This is definitely a more accurate count of the unique cities in the dataset now that we have altered the capitalized duplicates. 
However, the table still shows duplicate entries in the form of misspellings. Two examples are displayed below:  

SELECT DISTINCT (city) AS City 
FROM nth-baton-346119.iowa_liquor_sales.Iowa_Liquor_Sales_Table
WHERE city LIKE "Arnold%" OR city LIKE "Clear%"
ORDER BY city
;

Row	    City	
1	  Arnold's Park
2	  Arnolds Park
3	  Clear Lake
4	  ClearLake

Due to restricted altering and updating of data in BigQuery's sandbox account, no further action can be taken to correct the mistakes. 
However, a manual scan can be done to count the number of errors and calculate the true number of unique cities present in this dataset.

Number of errors counted: 11

467 - 11 = 456

  Within this dataset, there are 456 unique cities.


Question 3: How many unique liquor categories are there?
 
  To answer this question, I queried the distinct liquor category numbers from the "category" column.

SELECT DISTINCT (category) AS category_number, category_name
FROM nth-baton-346119.iowa_liquor_sales.Iowa_Liquor_Sales_Table
WHERE category IS NOT NULL
ORDER BY category
LIMIT 7
;

Results:

Row	 category_number	   category_name	
 1	    1011000.0      American Whiskies
 2	    1011100        Blended Whiskies
 3      1011100.0      BLENDED WHISKIES
 4	    1011100.0      Blended Whiskies
 5      1011200        Straight Bourbon Whiskies
 6      1011200.0      STRAIGHT BOURBON WHISKIES
 7      1011200.0      Straight Bourbon Whiskies

  Unfortunately there is a similar problem of different data formats. Some category numbers are entered twice, one version with a decimal place and a zero, and one without.
  The associated category names also differ, with some entered in all caps and some in sentence case. As a result, SQL has output a unique entry for each combination of 
  decimal and case if present. */

  To address this, I will select only distinct category numbers without decimals. Using the operator LENGTH, I will select all category numbers that have 7 characters. */

SELECT DISTINCT (category) AS Categories, category_name 
FROM nth-baton-346119.iowa_liquor_sales.Iowa_Liquor_Sales_Table
WHERE category IS NOT NULL AND LENGTH(category) = 7
ORDER BY category
;

Results:

Row	Categories	 category_name	
 1	 1011100   Blended Whiskies
 2	 1011200   Straight Bourbon Whiskies
 3	 1011300   Single Barrel Bourbon Whiskies
 4	 1011400   Tennessee Whiskies
 5	 1011500   Bottled in Bond Bourbon

  As displayed above, this has removed the differently entered data.

  However, there are still several entries that have unique category numbers and names, but the names are unique by either one letter difference (e.g. "Imported Vodka"
  vs "Imported Vodkas") or one space difference (e.g. "Cocktails / RTD" vs Cocktails /RTD"). Additional clarification would be required to confirm that these are unique 
  categories or duplicates that the system created a similar category number for while processing. 

SELECT COUNT(DISTINCT (category)) AS Categories 
FROM nth-baton-346119.iowa_liquor_sales.Iowa_Liquor_Sales_Table
WHERE category IS NOT NULL AND LENGTH(category) = 7

Results

Row	Categories	
 1	    55

  Without removing any of the entries discussed above, there are 55 unique categories of liquor in this database. 
  
  However, there are still several entries that have unique category numbers and names, but the names are unique by either one letter difference (e.g. "Imported Vodka"
  vs "Imported Vodkas") or one space difference (e.g. "Cocktails / RTD" vs Cocktails /RTD"). Additional clarification would be required to confirm that these are unique 
  categories or duplicates that the system created a similar category number for while processing.
  
  For the same reasons that the mis-entered city names could not be corrected, these similar liquor categories cannot be rectified. However, a manual count of these
  entries can be done.

Number of errors counted: 8

55 - 8 = 47

  Within this dataset, there are either 55 or 47 unique alcohol categories.
 
 
 
Analysis Questions:

Question 1: What was the total revenue generated by alcohol sales last year (2021) in Iowa?

SELECT SUM(sale_dollars) AS Total_Liquor_Sales          #Adding up each individual sale amount
FROM bigquery-public-data.iowa_liquor_sales.sales
WHERE date BETWEEN '2021-01-01' AND '2021-12-31'        #Filtering out sales not from 2021

Total_Liquor_Sales
  428123535.40


Question 2: What has been the total revenue generated by alcohol sales in Iowa each year since 2012?

SELECT 
  DISTINCT EXTRACT(YEAR from date) AS Year,
  SUM(sale_dollars) AS Total_Sales
FROM bigquery-public-data.iowa_liquor_sales.sales
GROUP BY Year
ORDER BY Year DESC

Results:

Year	Total_Sales
2022	96958258.030001268
2021	428123535.3999927
2020	396663131.6599943
2019	349220341.62998861
2018	334216843.07000631
2017	314530044.81004608
2016	299447564.85001493
2015	284328572.11001718
2014	270587738.09003007
2013	258103792.82005352
2012	255203313.57004404

  Here I am creating one column with unique dates by extracting the year from the date column and another column with the Total Sales value for each year. 
  The key here is the 'GROUP BY' function which organizes the sum totals by year

  However, since 2022 is ongoing, I do not have a full picture of what sales looks like yet. Because of this, the Total_Sales value for 2022 is much lower than the others.
  Therefore I will exclude 2022 from my queries:

SELECT 
  DISTINCT EXTRACT(YEAR from date) AS Year,
  ROUND(SUM(sale_dollars)) AS Total_Sales
FROM bigquery-public-data.iowa_liquor_sales.sales
WHERE date <='2021-12-31'        
GROUP BY Year
ORDER BY Year DESC

Year	Total_Sales
2021	428123535.4
2020	396663131.66
2019	349220341.63
2018	334216843.07
2017	314530044.81
2016	299447564.85
2015	284328572.11
2014	270587738.09
2013	258103792.82
2012	255203313.57

  Now, data from the year 2022 has been removed.
  I have also added the 'ROUND' command to round the sum totals to two decimal places.


Question 3: What has been the average annual alcohol revenue in Iowa since 2012?

SELECT 
  AVG(sale_dollars) AS Average_Annual_Revenue       
FROM bigquery-public-data.iowa_liquor_sales.sales
WHERE date <='2021-12-31'     

Average_Revenue
138.88

  This is clearly not the answer I was expecting. In this scenario, using the 'AVG' function in this case simply calculated the value of the average liquor purchase.
  While this would be a perfect answer for "What was the average amount spent on a single liquor purchase from 2012 to 2021?", this does not answer my question. 

  To fix this, instead of using the 'AVG' function, I will use the sum function and divide it by the number of full years of data (9). 
  With this in place

SELECT 
    ROUND(SUM(sale_dollars/9),2) AS Average_Annual_Revenue  
FROM bigquery-public-data.iowa_liquor_sales.sales
WHERE date <='2021-12-31'

Average_Annual_Revenue
    354491653.11

  Now we can see the average annual revenue from alcohol sales in Iowa from 2012 to 2021, which was around $350 million a year.


Question 4: What were the top 5 cities and counties by total sales in 2021?

Top 5 cities by alcohol sales:

SELECT 
    LOWER(city) AS City, 
    ROUND(SUM(sale_dollars)) AS Total_Sales,
FROM nth-baton-346119.iowa_liquor_sales.Iowa_Liquor_Sales_Table
WHERE city IS NOT NULL AND date BETWEEN '2021-1-1' AND '2021-12-31'
GROUP BY City
ORDER BY Total_Sales DESC
LIMIT 5
;

Results:

   City		      Total_Sales
des moines	    49521509.0
cedar rapids	  27401865.0
davenport	      21709074.0
west des moines	18757919.0
council bluffs	14886990.0

Top 5 counties by alcohol sales:

SELECT 
    LOWER(county) AS County, 
    ROUND(SUM(sale_dollars)) AS Total_Sales,
FROM nth-baton-346119.iowa_liquor_sales.Iowa_Liquor_Sales_Table
WHERE city IS NOT NULL AND date BETWEEN '2021-1-1' AND '2021-12-31'
GROUP BY County
ORDER BY Total_Sales DESC
LIMIT 5
;

  County	    Total_Sales
polk	        99027559.0
linn	        36729580.0
scott	        30367939.0
johnson	      24735545.0
black hawk	  23562358.0


Question 5: What were the top 5 cities and counties by total volume sold in 2021? Are they the same as total sales??

Top 5 cities by alcohol volume:

SELECT 
    LOWER(city) AS City, 
    ROUND(SUM(volume_sold_gallons)) AS Total_Volume_Gal,
FROM nth-baton-346119.iowa_liquor_sales.Iowa_Liquor_Sales_Table
WHERE city IS NOT NULL AND date BETWEEN '2021-1-1' AND '2021-12-31'
GROUP BY City
ORDER BY Total_Volume_Gal DESC
LIMIT 5
;

Results:

   City	       Total_Volume_Gal
des moines	      676873.0
cedar rapids	    413822.0
davenport	        321345.0
west des moines	  264630.0
council bluffs	  219901.0

Top 5 counties by alcohol volume:

SELECT 
    LOWER(county) AS County, 
    ROUND(SUM(volume_sold_gallons)) AS Total_Volume_Gal,
FROM nth-baton-346119.iowa_liquor_sales.Iowa_Liquor_Sales_Table
WHERE city IS NOT NULL AND date BETWEEN '2021-1-1' AND '2021-12-31'
GROUP BY County
ORDER BY Total_Volume_Gal DESC
LIMIT 5
;

Results:

County	  Total_Volume_Gal
polk	        1372115.0
linn	        566397.0
scott	        445801.0
johnson	      358810.0
black hawk	  348172.0

